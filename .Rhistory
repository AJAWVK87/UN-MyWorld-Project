testing<-NULL
testing<-indicators[-c(14:16)]
str(testing)
str(indicators)
testing<-indicators[-c(14:27)]
str(testing)
testing<-NULL
setwd()
getwd(0)
getwd()
setwd(~/mygit/UN-MyWorld-Project)
setwd(~mygit/UN-MyWorld-Project)
setwd(/Users/erinmcmahon/mygit/UN-MyWorld-Project)
setwd("~/mygit/UN-MyWorld-Project")
getwd()
str(indicators)
str(indicators)
indicators <- read.csv("/Users/erinmcmahon/mygit/UN-MyWorld-Project/Data/Indicators_final.csv")
#changing to num
indicators$X2005..YR2005 <- as.numeric(sub("#N/A",".",indicators$X2005..YR2005))
indicators$X2006..YR2006 <- as.numeric(sub("#N/A",".",indicators$X2006..YR2006))
indicators$X2007..YR2007 <- as.numeric(sub("#N/A",".",indicators$X2007..YR2007))
indicators$X2008..YR2008 <- as.numeric(sub("#N/A",".",indicators$X2008..YR2008))
indicators$X2009..YR2009 <- as.numeric(sub("#N/A",".",indicators$X2009..YR2009))
indicators$X2010..YR2010 <- as.numeric(sub("#N/A",".",indicators$X2010..YR2010))
indicators$X2011..YR2011 <- as.numeric(sub("#N/A",".",indicators$X2011..YR2011))
indicators$X2012..YR2012 <- as.numeric(sub("#N/A",".",indicators$X2012..YR2012))
indicators$X2013..YR2013 <- as.numeric(sub("#N/A",".",indicators$X2013..YR2013))
indicators['X2005..YR2005.']<-NULL
indicators['X2006..YR2006.']<-NULL
indicators['X2007..YR2007.']<-NULL
indicators['X2008..YR2008.']<-NULL
indicators['X2009..YR2009.']<-NULL
indicators['X2010..YR2010.']<-NULL
indicators['X2011..YR2011.']<-NULL
indicators['X2012..YR2012.']<-NULL
indicators['X2013..YR2013.']<-NULL
indicators$X2010.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2010..YR2010)
indicators$X2011.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2011..YR2011)
indicators$X2012.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2012..YR2012)
indicators$X2013.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2013..YR2013)
#creating change variable and counting change variable
indicators$delta1210<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2010..YR2010,x2=indicators$X2012..YR2012)
indicators$delta1210.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta1210)
indicators$delta10<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2010..YR2010)
indicators$delta10.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta10)
indicators$delta11<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2010..YR2010,x2=indicators$X2011..YR2011)
indicators$delta11.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta11)
indicators$delta12<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2011..YR2011,x2=indicators$X2012..YR2012)
indicators$delta12.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta12)
indicators$delta13<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2012..YR2012,x2=indicators$X2013..YR2013)
indicators$delta13.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta13)
ind <- aggregate(indicators[,c("delta10.count","delta1210.count","delta11.count","delta12.count","delta13.count","X2010.count","X2011.count","X2012.count","X2013.count")],list(indicators$Indicator.Name),sum)
#whether we have enough data for indicator
ind$missing.2010 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2010.count)
ind$missing.2011 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2011.count)
ind$missing.2012 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2012.count)
ind$missing.2013 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2013.count)
#whether we have enough data for imputation
ind$missingdelta.10 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta10.count)
ind$missingdelta.1210 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta1210.count)
ind$missingdelta.11 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta11.count)
ind$missingdelta.12 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta12.count)
ind$missingdelta.13 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta13.count)
meansum<- aggregate(indicators[,c("delta1210","delta11","delta12")],by=list(indicators$Indicator.Name),FUN=mean, na.rm=TRUE)
meansum$delta1210 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1210)
meansum$delta11 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta11)
meansum$delta12 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta12)
names(meansum)[names(meansum)=='Group.1']<-'Indicator.Name'
#binding average deltas to counts dataframe
ind<-cbind(ind,meansum)
ind$Group.1<-NULL
ind$delta1210final<-mapply(function(x,y) { if (y==0) {return (NA)} else { return (x)}}, x=ind$delta1210,y=ind$missing.2010)
ind$delta11final<-mapply(function(x,y) { if (y==0) {return (NA)} else { return (x)}}, x=ind$delta11,y=ind$missing.2010)
ind$delta12final<-mapply(function(x,y) { if (y==0) {return (NA)} else { return (x)}}, x=ind$delta12,y=ind$missing.2011)
indicators<- merge(indicators[-c(14:27)],ind[c("Indicator.Name","X2010.count","X2011.count","X2012.count","X2013.count","delta1210final","delta11final","delta12final")],by=c("Indicator.Name"))
str(indicators)
indexMissing<-which(is.na(indicators$X2012..YR2012))
indicators$X2012Impute<-indicators$X2012..YR2012
indicators$indexMissing<-0
indicators$indexMissing[indexMissing]<-1
indicators$X2012Impute[indexMissing]<- indicators$X2011..YR2011[indexMissing]*indicators$delta12final[indexMissing]
indexMissing10<-which(is.na(indicators$X2012Impute))
indicators$X2012Impute[indexMissing10]<- indicators$X2010..YR2010[indexMissing10]*indicators$delta1210final[indexMissing10]
unq <- read.csv("/Users/erinmcmahon/mygit/UN-MyWorld-Project/Data/Impute_Green.csv")
unq$Year<-as.character(unq$Year)
names(unq)[names(unq)=='Year']<-'YearImpute'
str(unq)
indicators<-merge(indicators,unq[c("Indicator.Name","Comment","Year")],by=c("Indicator.Name"),all=TRUE)
indicators<-merge(indicators,unq[c("Indicator.Name","Comment","YearImpute")],by=c("Indicator.Name"),all=TRUE)
str(indicators)
library(data.table)
install.packages(data.table)
install.packages("data.table")
testing<-indicators
testing$test<-indicators[which(is.na(indicators$YearImpute)==FALSE)]
which(is.na(indicators$YearImpute==FALSE))
testing['X2012..YR2012'][10856]
testing['X2012..YR2012'][,10856]
testing['X2012..YR2012',10856]
testing['X2012..YR2012',46224]
testing['YearImpute',46224]
tail(testing)
testing['YearImpute']
testing$YearImpute[46224]
testing['YearImpute'][46224]
testing['YearImpute'][,46224]
testing[,'YearImpute'][,46224]
testing[,'YearImpute'][46224]
testing$test<-indicators[which(is.na(indicators$YearImpute)==FALSE)][,indicators$YearImpute]
which(is.na(indicators$YearImpute)==FALSE)
indicators[which(is.na(indicators$YearImpute)==FALSE)]
indicators$YearImpute[which(is.na(indicators$YearImpute)==FALSE)]
indicators[which(is.na(indicators$YearImpute)==FALSE)][,indicators$YearImpute]
indicators[which(is.na(indicators$YearImpute)==FALSE)][,YearImpute]
indicators[,YearImpute]
indicators[,YearsImpute]
str(indicators)
testing[,YearsImpute]
testing[,YearImpute]
testing[YearImpute]
testing[YearImpute[1]]
testing[YearImpute[46224]]
testing[testing$YearImpute[46224]]
testing[,testing$YearImpute[46224]]
testing[46224][,testing$YearImpute[46224]]
head(testing[46224][,testing$YearImpute[46224]])
head(testing[,testing$YearImpute[46224]])
head(testing[testing$YearImpute[46224]])
head(testing[testing$YearImpute[46224]][,46224])
testing$test<-indicators$X2011..YR2011[which((indicators$YearImpute)=='X2011..YR2011')]
length(which((indicators$YearImpute)=='X2011..YR2011'))
length(indicators$YearImpute)
head(indicators$YearImpute)
testing$test[which((indicators$YearImpute)=='X2011..YR2011')]<-indicators$X2011..YR2011[which((indicators$YearImpute)=='X2011..YR2011')]
tail(testing)
unqYear<-unique(unq$YearImpute)
unqYear
head(indicators$unqYear[i])
testing$test[which((indicators$YearImpute)=='X2011..YR2011')]<-indicators$X2011..YR2011[which((indicators$YearImpute)=='X2011..YR2011')]
testing$test[which((indicators$YearImpute)=='X2010..YR2010')]<-indicators$X2010..YR2010[which((indicators$YearImpute)=='X2010..YR2010')]
testing$test[which((indicators$YearImpute)=='X2009..YR2009')]<-indicators$X2009..YR2009[which((indicators$YearImpute)=='X2009..YR2009')]
testing$test[which((indicators$YearImpute)=='X2008..YR2008')]<-indicators$X2008..YR2008[which((indicators$YearImpute)=='X2008..YR2008')]
testing$test[which((indicators$YearImpute)=='X2005..YR2005')]<-indicators$X2005..YR2005[which((indicators$YearImpute)=='X2005..YR2005')]
testing$test[which((indicators$YearImpute)=='X2013..YR2013')]<-indicators$X2013..YR2013[which((indicators$YearImpute)=='X2013..YR2013')]
str(testing)
tail(testing)
testing$X2012Impute[which((indicators$YearImpute)=='X2011..YR2011')]<-indicators$X2011..YR2011[which((indicators$YearImpute)=='X2011..YR2011')]
testing$X2012Impute[which((indicators$YearImpute)=='X2010..YR2010')]<-indicators$X2010..YR2010[which((indicators$YearImpute)=='X2010..YR2010')]
testing$X2012Impute[which((indicators$YearImpute)=='X2009..YR2009')]<-indicators$X2009..YR2009[which((indicators$YearImpute)=='X2009..YR2009')]
testing$X2012Impute[which((indicators$YearImpute)=='X2008..YR2008')]<-indicators$X2008..YR2008[which((indicators$YearImpute)=='X2008..YR2008')]
testing$X2012Impute[which((indicators$YearImpute)=='X2005..YR2005')]<-indicators$X2005..YR2005[which((indicators$YearImpute)=='X2005..YR2005')]
testing$X2012Impute[which((indicators$YearImpute)=='X2013..YR2013')]<-indicators$X2013..YR2013[which((indicators$YearImpute)=='X2013..YR2013')]
testing$test<-NULL
tail(testing)
test<-cbind(testing$Indicator.Name,testing$X2012..YR2012,testing$X2012Impute,testing$X2011..YR2011,testing$X2010..YR2010,testing$YearImpute)
test
test<-cbind(testing$Indicator.Name,testing$X2012..YR2012,testing$X2011..YR2011,testing$X2010..YR2010,testing$X2012Impute)
test
test<-cbind(testing$Indicator.Name,testing$X2012..YR2012,testing$X2011..YR2011,testing$X2012Impute)
test
tail(test,300)
indicators$X2012Impute[which((indicators$YearImpute)=='X2011..YR2011')]<-indicators$X2011..YR2011[which((indicators$YearImpute)=='X2011..YR2011')]
indicators$X2012Impute[which((indicators$YearImpute)=='X2010..YR2010')]<-indicators$X2010..YR2010[which((indicators$YearImpute)=='X2010..YR2010')]
indicators$X2012Impute[which((indicators$YearImpute)=='X2009..YR2009')]<-indicators$X2009..YR2009[which((indicators$YearImpute)=='X2009..YR2009')]
indicators$X2012Impute[which((indicators$YearImpute)=='X2008..YR2008')]<-indicators$X2008..YR2008[which((indicators$YearImpute)=='X2008..YR2008')]
indicators$X2012Impute[which((indicators$YearImpute)=='X2005..YR2005')]<-indicators$X2005..YR2005[which((indicators$YearImpute)=='X2005..YR2005')]
indicators$X2012Impute[which((indicators$YearImpute)=='X2013..YR2013')]<-indicators$X2013..YR2013[which((indicators$YearImpute)=='X2013..YR2013')]
str(indicators)
sum(is.na(X2012Impute)==TRUE)
sum(is.na(indicators$X2012Impute)==TRUE)
testing<-NULL
unq<-NULL
test<-NULL
meansum<-NULL
indicators<-NULL
ind<-NULL
ind<-NULL
indexMissing<-NULL
indexMissiong10<-NULL
indicators <- read.csv("/Users/erinmcmahon/mygit/UN-MyWorld-Project/Data/Indicators_final.csv")
indicators$X2005..YR2005 <- as.numeric(sub("#N/A",".",indicators$X2005..YR2005))
indicators$X2006..YR2006 <- as.numeric(sub("#N/A",".",indicators$X2006..YR2006))
indicators$X2007..YR2007 <- as.numeric(sub("#N/A",".",indicators$X2007..YR2007))
indicators$X2008..YR2008 <- as.numeric(sub("#N/A",".",indicators$X2008..YR2008))
indicators$X2009..YR2009 <- as.numeric(sub("#N/A",".",indicators$X2009..YR2009))
indicators$X2010..YR2010 <- as.numeric(sub("#N/A",".",indicators$X2010..YR2010))
indicators$X2011..YR2011 <- as.numeric(sub("#N/A",".",indicators$X2011..YR2011))
indicators$X2012..YR2012 <- as.numeric(sub("#N/A",".",indicators$X2012..YR2012))
indicators$X2013..YR2013 <- as.numeric(sub("#N/A",".",indicators$X2013..YR2013))
indicators['X2005..YR2005.']<-NULL
indicators['X2006..YR2006.']<-NULL
indicators['X2007..YR2007.']<-NULL
indicators['X2008..YR2008.']<-NULL
indicators['X2009..YR2009.']<-NULL
indicators['X2010..YR2010.']<-NULL
indicators['X2011..YR2011.']<-NULL
indicators['X2012..YR2012.']<-NULL
indicators['X2013..YR2013.']<-NULL
indicators$X2010.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2010..YR2010)
indicators$X2011.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2011..YR2011)
indicators$X2012.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2012..YR2012)
indicators$X2013.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2013..YR2013)
#creating change variable and counting change variable
indicators$delta1210<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2010..YR2010,x2=indicators$X2012..YR2012)
indicators$delta1210.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta1210)
indicators$delta10<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2010..YR2010)
indicators$delta10.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta10)
indicators$delta11<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2010..YR2010,x2=indicators$X2011..YR2011)
indicators$delta11.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta11)
indicators$delta12<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2011..YR2011,x2=indicators$X2012..YR2012)
indicators$delta12.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta12)
indicators$delta13<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2012..YR2012,x2=indicators$X2013..YR2013)
indicators$delta13.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta13)
indicators$delta1008<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2008..YR2008,x2=indicators$X2008..YR2008)
indicators$delta1009<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2009..YR2009)
indicators$delta1109<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2012..YR2011)
indicators$delta1110<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2010..YR2010,x2=indicators$X2011..YR2011)
#need these too
indicators$delta1008<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2008..YR2008,x2=indicators$X2008..YR2008)
indicators$delta1009<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2009..YR2009)
indicators$delta1109<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2012..YR2011)
indicators$delta1110<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2010..YR2010,x2=indicators$X2011..YR2011)
str(indicators)
indicators$delta1008<-NULL
indicators$delta1009<-NULL
indicators$delta1109<-NULL
indicators$delta1110<-NULL
str(indicators)
#need these too
indicators$delta1008<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2008..YR2008,x2=indicators$X2010..YR2010)
indicators$delta1009<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2010..YR2010)
indicators$delta1109<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2011..YR2011)
indicators$delta1110<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2010..YR2010,x2=indicators$X2011..YR2011)
ind <- aggregate(indicators[,c("delta10.count","delta1210.count","delta11.count","delta12.count","delta13.count","X2010.count","X2011.count","X2012.count","X2013.count")],list(indicators$Indicator.Name),sum)
#whether we have enough data for indicator
ind$missing.2010 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2010.count)
ind$missing.2011 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2011.count)
ind$missing.2012 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2012.count)
ind$missing.2013 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2013.count)
#whether we have enough data for imputation
ind$missingdelta.10 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta10.count)
ind$missingdelta.1210 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta1210.count)
ind$missingdelta.11 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta11.count)
ind$missingdelta.12 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta12.count)
ind$missingdelta.13 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta13.count)
str(ind)
meansum<- aggregate(indicators[,c("delta1210","delta11","delta12","delta1110","delta1109","delta1009","delta1008")],by=list(indicators$Indicator.Name),FUN=mean, na.rm=TRUE)
meansum$delta1210 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1210)
meansum$delta11 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta11)
meansum$delta12 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta12)
meansum$delta1008 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1008)
meansum$delta1009 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1009)
meansum$delta1109 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1109)
meansum$delta1110 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1110)
names(meansum)[names(meansum)=='Group.1']<-'Indicator.Name'
str(meansum)
ind<-cbind(ind,meansum)
ind$Group.1<-NULL
ind$delta1210final<-mapply(function(x,y) { if (y==0) {return (NA)} else { return (x)}}, x=ind$delta1210,y=ind$missing.2010)
ind$delta11final<-mapply(function(x,y) { if (y==0) {return (NA)} else { return (x)}}, x=ind$delta11,y=ind$missing.2010)
ind$delta12final<-mapply(function(x,y) { if (y==0) {return (NA)} else { return (x)}}, x=ind$delta12,y=ind$missing.2011)
str(ind)
indicators<- merge(indicators[-c(14:27)],ind[c("Indicator.Name","X2010.count","X2011.count","X2012.count","X2013.count","delta1008","delta1009","delta1109","delta1110","delta1210final","delta11final","delta12final",)],by=c("Indicator.Name"))
indicators<- merge(indicators[-c(14:27)],ind[c("Indicator.Name","X2010.count","X2011.count","X2012.count","X2013.count","delta1008","delta1009","delta1109","delta1110","delta1210final","delta11final","delta12final")],by=c("Indicator.Name"))
str(indicators)
indicators <- read.csv("/Users/erinmcmahon/mygit/UN-MyWorld-Project/Data/Indicators_final.csv")
#changing to num
indicators$X2005..YR2005 <- as.numeric(sub("#N/A",".",indicators$X2005..YR2005))
indicators$X2006..YR2006 <- as.numeric(sub("#N/A",".",indicators$X2006..YR2006))
indicators$X2007..YR2007 <- as.numeric(sub("#N/A",".",indicators$X2007..YR2007))
indicators$X2008..YR2008 <- as.numeric(sub("#N/A",".",indicators$X2008..YR2008))
indicators$X2009..YR2009 <- as.numeric(sub("#N/A",".",indicators$X2009..YR2009))
indicators$X2010..YR2010 <- as.numeric(sub("#N/A",".",indicators$X2010..YR2010))
indicators$X2011..YR2011 <- as.numeric(sub("#N/A",".",indicators$X2011..YR2011))
indicators$X2012..YR2012 <- as.numeric(sub("#N/A",".",indicators$X2012..YR2012))
indicators$X2013..YR2013 <- as.numeric(sub("#N/A",".",indicators$X2013..YR2013))
indicators['X2005..YR2005.']<-NULL
indicators['X2006..YR2006.']<-NULL
indicators['X2007..YR2007.']<-NULL
indicators['X2008..YR2008.']<-NULL
indicators['X2009..YR2009.']<-NULL
indicators['X2010..YR2010.']<-NULL
indicators['X2011..YR2011.']<-NULL
indicators['X2012..YR2012.']<-NULL
indicators['X2013..YR2013.']<-NULL
#counting
indicators$X2010.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2010..YR2010)
indicators$X2011.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2011..YR2011)
indicators$X2012.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2012..YR2012)
indicators$X2013.count <-mapply(function(x) {return(is.finite(x))},x=indicators$X2013..YR2013)
#creating change variable and counting change variable
indicators$delta1210<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2010..YR2010,x2=indicators$X2012..YR2012)
indicators$delta1210.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta1210)
indicators$delta10<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2010..YR2010)
indicators$delta10.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta10)
indicators$delta11<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2010..YR2010,x2=indicators$X2011..YR2011)
indicators$delta11.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta11)
indicators$delta12<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2011..YR2011,x2=indicators$X2012..YR2012)
indicators$delta12.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta12)
indicators$delta13<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2012..YR2012,x2=indicators$X2013..YR2013)
indicators$delta13.count<- mapply(function(x) {return (is.finite(x))}, x=indicators$delta13)
#need these too
indicators$delta1008<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2008..YR2008,x2=indicators$X2010..YR2010)
indicators$delta1009<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2010..YR2010)
indicators$delta1109<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2009..YR2009,x2=indicators$X2011..YR2011)
indicators$delta1110<-mapply(function(x1,x2) {return (x2/x1-1)}, x1=indicators$X2010..YR2010,x2=indicators$X2011..YR2011)
ind <- aggregate(indicators[,c("delta10.count","delta1210.count","delta11.count","delta12.count","delta13.count","X2010.count","X2011.count","X2012.count","X2013.count")],list(indicators$Indicator.Name),sum)
#whether we have enough data for indicator
ind$missing.2010 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2010.count)
ind$missing.2011 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2011.count)
ind$missing.2012 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2012.count)
ind$missing.2013 <- mapply(function(x) { if (x>=100) {return (1)} else {return (0)}}, x=ind$X2013.count)
#whether we have enough data for imputation
ind$missingdelta.10 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta10.count)
ind$missingdelta.1210 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta1210.count)
ind$missingdelta.11 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta11.count)
ind$missingdelta.12 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta12.count)
ind$missingdelta.13 <- mapply(function(x) { if (x>=95) {return (1)} else {return (0)}}, x=ind$delta13.count)
#average delta for variable
meansum<- aggregate(indicators[,c("delta1210","delta11","delta12","delta1110","delta1109","delta1009","delta1008")],by=list(indicators$Indicator.Name),FUN=mean, na.rm=TRUE)
meansum$delta1210 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1210)
meansum$delta11 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta11)
meansum$delta12 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta12)
meansum$delta1008 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1008)
meansum$delta1009 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1009)
meansum$delta1109 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1109)
meansum$delta1110 <- mapply(function(x) {if (isTRUE(is.finite(x))) {return (x)} else {return (NA)}}, x=meansum$delta1110)
names(meansum)[names(meansum)=='Group.1']<-'Indicator.Name'
#binding average deltas to counts dataframe
ind<-cbind(ind,meansum)
ind$Group.1<-NULL
#if the count is greater than 95, set delta
ind$delta1210final<-mapply(function(x,y) { if (y==0) {return (NA)} else { return (x)}}, x=ind$delta1210,y=ind$missing.2010)
ind$delta11final<-mapply(function(x,y) { if (y==0) {return (NA)} else { return (x)}}, x=ind$delta11,y=ind$missing.2010)
ind$delta12final<-mapply(function(x,y) { if (y==0) {return (NA)} else { return (x)}}, x=ind$delta12,y=ind$missing.2011)
str(indicators)
indicators<- merge(indicators[-c(14:31)],ind[c("Indicator.Name","X2010.count","X2011.count","X2012.count","X2013.count","delta1008","delta1009","delta1109","delta1110","delta1210final","delta11final","delta12final")],by=c("Indicator.Name"))
str(indicators)
indexMissing<-which(is.na(indicators$X2012..YR2012))
indicators$X2012Impute<-indicators$X2012..YR2012
indicators$indexMissing<-0
indicators$indexMissing[indexMissing]<-1
indicators$X2012Impute[indexMissing]<- indicators$X2011..YR2011[indexMissing]*indicators$delta12final[indexMissing]
indexMissing10<-which(is.na(indicators$X2012Impute))
indicators$X2012Impute[indexMissing10]<- indicators$X2010..YR2010[indexMissing10]*indicators$delta1210final[indexMissing10]
str(indicators)
unq <- read.csv("/Users/erinmcmahon/mygit/UN-MyWorld-Project/Data/Impute_Green.csv")
unq$Year<-as.character(unq$Year)
names(unq)[names(unq)=='Year']<-'YearImpute'
unqYear<-unique(unq$YearImpute)
indicators<-merge(indicators,unq[c("Indicator.Name","Comment","YearImpute")],by=c("Indicator.Name"),all=TRUE)
str(indicators)
sum(is.na(X2012Impute)==TRUE)
sum(is.na(indicators$X2012Impute)==TRUE)
indicators$X2012Impute[which((indicators$YearImpute)=='X2011..YR2011')]<-indicators$X2011..YR2011[which((indicators$YearImpute)=='X2011..YR2011')]
indicators$X2012Impute[which((indicators$YearImpute)=='X2010..YR2010')]<-indicators$X2010..YR2010[which((indicators$YearImpute)=='X2010..YR2010')]
indicators$X2012Impute[which((indicators$YearImpute)=='X2009..YR2009')]<-indicators$X2009..YR2009[which((indicators$YearImpute)=='X2009..YR2009')]
indicators$X2012Impute[which((indicators$YearImpute)=='X2008..YR2008')]<-indicators$X2008..YR2008[which((indicators$YearImpute)=='X2008..YR2008')]
indicators$X2012Impute[which((indicators$YearImpute)=='X2005..YR2005')]<-indicators$X2005..YR2005[which((indicators$YearImpute)=='X2005..YR2005')]
indicators$X2012Impute[which((indicators$YearImpute)=='X2013..YR2013')]<-indicators$X2013..YR2013[which((indicators$YearImpute)=='X2013..YR2013')]
sum(is.na(indicators$X2012Impute)==TRUE)
testing<-indicators
indexMissing10Impute<-which((is.na(indicators$YearImpute)=='X2010..YR2010')&(is.na(indicators$X2012Impute)==TRUE))
indexMissing10Impute
indexMissing10Impute<-which(((indicators$YearImpute)=='X2010..YR2010')&(is.na(indicators$X2012Impute)==TRUE))
indexMissing10Impute
length(indexMissing10Impute)
str(indicators)
length(indexMissing10Impute)
testing$X2012Impute[indexMissing10Impute]<-indicators$X2009..YR2009[indexMissing10Impute]*indicators$delta1009[indexMissing10Impute]
indexMissing10Impute<-which(((testing$YearImpute)=='X2010..YR2010')&(is.na(testing$X2012Impute)==TRUE))
length(indexMissing10Impute)
str(indicators)
indexMissing10Impute<-which(((indicators$YearImpute)=='X2010..YR2010')&(is.na(indicators$X2012Impute)==TRUE))
indicators$X2012Impute[indexMissing10Impute]<-indicators$X2009..YR2009[indexMissing10Impute]*indicators$delta1009[indexMissing10Impute]
length(indexMissing10Impute)
indexMissing10Impute<-which(((indicators$YearImpute)=='X2010..YR2010')&(is.na(indicators$X2012Impute)==TRUE))
indicators$X2012Impute[indexMissing10Impute]<-indicators$X2008..YR2008[indexMissing10Impute]*indicators$delta1008[indexMissing10Impute]
length(indexMissing10Impute)
indexMissing11Impute<-which(((indicators$YearImpute)=='X2011..YR2011')&(is.na(indicators$X2012Impute)==TRUE))
indicators$X2012Impute[indexMissing11Impute]<-indicators$X2010..YR2010[indexMissing11Impute]*indicators$delta1110[indexMissing11Impute]
#re-run for 2009: 2010's will now be filtered out
length(indexMissing11Impute)
indexMissing11Impute<-which(((indicators$YearImpute)=='X2011..YR2011')&(is.na(indicators$X2012Impute)==TRUE))
indicators$X2012Impute[indexMissing11Impute]<-indicators$X2009..YR2009[indexMissing11Impute]*indicators$delta1109[indexMissing11Impute]
length(indexMissing11Impute)
sum(is.na(indicators$X2012Impute)==FALSE))
sum(is.na(indicators$X2012Impute))
names(ind$Indicator.Names)
unique(ind$Indicator.Names)
str(ind)
unique(ind$Indicator.Name)
ind$Indicator.Name[50]
View(ind)
ind$missing.2010[50]
ind$X2012.count[50]
del <- read.csv("/Users/erinmcmahon/mygit/UN-MyWorld-Project/Data/Impute_Red.csv")
str(del)
del$Indicator.Name[1]
del <- read.csv("/Users/erinmcmahon/mygit/UN-MyWorld-Project/Data/Impute_Red.csv")
str(del)
del$Indicator.Name[1]
head(indicators[del$Indicator.Name[1]])
head(indicators$Indicator.Name[del$Indicator.Name[1]])
del$Indicator.Name[1]
del$Indicator.Name<-as.character(del$Indicator.Name)
str(del)
del[1]
del$Indicator.Name[1]
indicators$Indicator.Name[del$Indicator.Name[1]]
value<-del$Indicator.Name[1]
indicators$Indicator.Name[value]
unique(indicators$Indicator.Name)
indicators$Indicator.Name['Agricultural machinery, tractors per 100 sq. km of arable land']
indicators$Indicator.Name['Agricultural machinery, tractors per 100 sq. km of arable land ']
str(indicators)
delunq<- unique(del$Indicator.Name)
delunq
testing[-which(delunq %in% delunq),]
str(testing)
head(testing)
delunq
delunq<- sorted(unique(del$Indicator.Name))
delunq<-sort(delunq)
delunq
test[-which(delunq %in% delunq),]
testing[-which(delunq %in% delunq),]
str(testing)
testing[-which(testing$Indicator.Name %in% delunq),]
str(testing)
str(del)
indicators<-merge(indicators,del[c("Indicator.Name","Comment")],by=c("Indicator.Name"),all=TRUE)
str(indicators)
testing<-indicators
delIndex<-which(Indicators$Comment.y=='Remove')
delIndex<-which(indicators$Comment.y=='Remove')
len(delIndex)
length(delIndex)
testing[-r(delIndex),]
testing[-(delIndex),]
str(testing)
testing[!(testing$Comment.y)=='Remove',]
str(testing)
testing[!(testing$Comment.y)==1,]
str(testing)
testing$Comment.y==1
head(testing$Comment.y=='remove')
head(testing$Comment.y)
head(testing$Comment.y==remove)
head(testing$Comment.y=='Remove')
testing[!(testing$Comment.y)=='Remove',]
str(testing)
testing[!((testing$Comment.y)=='Remove'),]
str(testing)
testing<-testing[!((testing$Comment.y)=='Remove'),]
str(testing)
head(testing)
testing<-indicators
head(testing)
head(testing,1000)
tail(testing,300)
testing<-testing[!((testing$Comment.y)=='Remove'),]
str(testing)
tail(testing,300)
testing<-indicators
delIndex<-which(indicators$Comment.y=='Remove')
length(delIndex)
testing<-test[!delIndex,]
tail(testing)
testing<-indicators
testing<-testing[!delIndex,]
tail(testing)
testing<-indicators
testing<-testing[-delIndex,]
tail(testing)
str(testing)
head(testing)
head(testing)
head(indicators,1000)
head(testing)
testing<-indicators
testing$Indicator.Name[1]
testing$Indicator.Name[2]
testing$Indicator.Name[3]
testing<-indicators
testing<-testing[which(testing$Comment.y=='Remove')]
testing$Comment.y=='Remove'
testing<-testing[which(testing$Comment.y=='Remove'),]
str(testing)
testing<-indicators
testing<-testing[which(testing$Comment.y!='Remove'),]
str(testing)
testing<-indicators
str(testing)
testing<-testing[which(testing$Comment.y!='Remove'),]
str(testing)
testing<-indicators[which(indicators$Comment.y=='Remove'),]
str(testing)
unique(testing$Indicator.Name)
testing<-indicators[which(indicators$Comment.y!=='Remove'),]
testing<-indicators[which(indicators$Comment.y!='Remove'),]
testing
testing<-indicators[which(is.na(indicators$Comment.y)),]
str(testing)
unique(testing$Indicator.Name)
indicators<-indicators[which(is.na(indicators$Comment.y)),]
str(indicators)
indicators$Comment.y<-NULL
str(indicators)
sum(is.na(X2012Impute))
sum(is.na(indicators$X2012Impute))
